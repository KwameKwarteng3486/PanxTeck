<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<style>

body {
    background-color: #3a3a3a;
    color: white;
    font-family: Arial, sans-serif;
}

.weather-app {
    margin-top: 50px;
}

.weather-card {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.5);
    position: relative;
}

#rain-animation {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url('rain.gif'); /* Add rain gif here */
    background-size: cover;
    opacity: 0;
    z-index: 1;
}

.temperature {
    font-size: 60px;
}

#forecast {
    display: flex;
    justify-content: space-around;
    margin-top: 20px;
}

.forecast-card {
    width: 60px;
    text-align: center;
}

.forecast-card img {
    width: 40px;
    height: 40px;
}

/* Rain animation */
@keyframes rain {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

</style>
<body>

<div class="container text-center weather-app">
    <div class="weather-card">
        <div id="rain-animation"></div>
        <h2 id="location">Loading...</h2>
        <div id="temperature" class="temperature">--°</div>
        <div id="condition">--</div>
        <div class="high-low">
            H: <span id="high-temp">--</span>° L: <span id="low-temp">--</span>°
        </div>
        <div id="forecast-text">Fetching forecast...</div>
        <div class="forecast">
            <div id="forecast" class="forecast-cards"></div>
        </div>
    </div>
</div>

<script>

document.addEventListener('DOMContentLoaded', function () {
    // Get weather information
    function getWeather() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;

                // OpenWeatherMap API call
                const apiKey = '2df2f2db86c791819de19980c828c7b5'; // Replace with your API key
                const apiUrl = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=minutely&appid=${apiKey}&units=metric`;

                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        displayWeather(data);
                        checkRainTime(data.hourly);
                    })
                    .catch(error => {
                        console.error('Error fetching weather data:', error);
                    });
            });
        } else {
            alert('Geolocation is not supported by your browser.');
        }
    }

    function displayWeather(data) {
        const locationName = 'Atwima'; // This could be dynamic based on user's location.
        const currentTemp = Math.round(data.current.temp);
        const weatherDescription = data.current.weather[0].description;
        const highTemp = Math.round(data.daily[0].temp.max);
        const lowTemp = Math.round(data.daily[0].temp.min);

        document.getElementById('location').textContent = locationName;
        document.getElementById('temperature').textContent = `${currentTemp}°`;
        document.getElementById('condition').textContent = weatherDescription.charAt(0).toUpperCase() + weatherDescription.slice(1);
        document.getElementById('high-temp').textContent = highTemp;
        document.getElementById('low-temp').textContent = lowTemp;

        // Forecast
        const forecastDiv = document.getElementById('forecast');
        data.daily.slice(1, 4).forEach((day, index) => {
            const forecastCard = document.createElement('div');
            forecastCard.classList.add('forecast-card');
            forecastCard.innerHTML = `
                <div>${new Date(day.dt * 1000).toLocaleDateString('en', { weekday: 'short' })}</div>
                <img src="http://openweathermap.org/img/wn/${day.weather[0].icon}@2x.png" alt="${day.weather[0].description}">
                <div>${Math.round(day.temp.max)}°</div>
            `;
            forecastDiv.appendChild(forecastCard);
        });

        // If raining, animate rain
        if (weatherDescription.includes('rain')) {
            animateRain();
        }
    }

    function animateRain() {
        const rainAnimation = document.getElementById('rain-animation');
        rainAnimation.style.opacity = 1;
        rainAnimation.style.animation = 'rain 1s ease-in-out forwards';
    }

    function checkRainTime(hourlyData) {
        // Loop through hourly data to check for upcoming rain
        let rainTime = '';
        hourlyData.forEach(hour => {
            const rainChance = hour.pop; // Probability of precipitation (rain chance)
            const weatherDescription = hour.weather[0].description;

            if (rainChance > 0.4 && weatherDescription.includes('rain')) {
                const time = new Date(hour.dt * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                rainTime = `Expected rain around ${time}`;
                document.getElementById('forecast-text').textContent = rainTime;
                return;
            }
        });

        if (!rainTime) {
            document.getElementById('forecast-text').textContent = 'No rain expected in the next few hours.';
        }
    }

    getWeather();
});

</script>
</body>
</html>
